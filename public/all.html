<!DOCTYPE html>
<html>
<head>
  <title>Item列表</title>
  <style>
    table {
      border-collapse: collapse;
      width: 100%;
    }

    th, td {
      border: 1px solid black;
      padding: 8px;
      text-align: left;
    }
  </style>
</head>
<body>
  <table>
    <thead>
      <tr>
        <th>Key</th>
        <th>Value</th>
        <th>Created At</th>
        <th>Updated At</th>
        <th>操作</th>
      </tr>
    </thead>
    <tbody id="itemTableBody"></tbody>
  </table>

  <script>
    const apiUrl = 'https://quna.cf/api/url/';

    // 使用fetch函数获取item数据
    fetch(apiUrl)
      .then(response => response.json())
      .then(data => {
        const itemTableBody = document.getElementById('itemTableBody');

        // 遍历item数组并创建表格行
        data.forEach(item => {
          const row = document.createElement('tr');

          // 创建单元格并填充数据
          const keyCell = document.createElement('td');
          keyCell.textContent = item.key;
          row.appendChild(keyCell);

          const valueCell = document.createElement('td');
          valueCell.textContent = item.value;
          row.appendChild(valueCell);

          const createdAtCell = document.createElement('td');
          createdAtCell.textContent = item.createdAt;
          row.appendChild(createdAtCell);

          const updatedAtCell = document.createElement('td');
          updatedAtCell.textContent = item.updatedAt;
          row.appendChild(updatedAtCell);

          // 创建删除按钮
          const deleteButton = document.createElement('button');
          deleteButton.textContent = '删除';
          deleteButton.addEventListener('click', () => {
            const confirmDelete = confirm('确定要删除这个item吗？');
            if (confirmDelete) {
              deleteItem(item.id, item.value);
            }
          });

          const deleteCell = document.createElement('td');
          deleteCell.appendChild(deleteButton);
          row.appendChild(deleteCell);

          // 将行添加到表格主体
          itemTableBody.appendChild(row);
        });
      })
      .catch(error => {
        console.error('Error:', error);
      });

    // 删除item
    function deleteItem(itemId, itemValue) {
      const deleteUrl = `https://quna.cf/api/${itemValue}`;

      fetch(deleteUrl, {
        method: 'DELETE'
      })
        .then(response => {
          if (response.ok) {
            alert('删除成功！');
            location.reload(); // 刷新页面以更新表格
          } else {
            throw new Error('删除失败！');
          }
        })
        .catch(error => {
          console.error('Error:', error);
        });
    }
  </script>
</body>
</html>
